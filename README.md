# Духовные песни: сборник текстов и мелодий

## Обзор функциональности

Приложение "Духовные песни" представляет собой удобный сборник духовных песен с возможностью поиска, добавления в избранное и автоматического обновления базы данных.

### Основные возможности

1. **Просмотр песен** - Легкий доступ ко всем песням в базе данных с удобной навигацией.
2. **Поиск песен** - Быстрый поиск по названию или тексту песни.
3. **Избранные песни** - Возможность добавлять песни в избранное для быстрого доступа.
4. **Автоматическое обновление** - Периодическое обновление базы данных из интернета.
5. **Настраиваемый интерфейс** - Выбор размера шрифта и темы оформления.
6. **Масштабирование текста** - Возможность изменять размер текста при просмотре песни.

### Возможности масштабирования текста

Реализована продвинутая система масштабирования текста в экране просмотра песни:

1. **Жесты масштабирования** - Изменение размера текста с помощью жеста "щипка" (pinch-to-zoom).
2. **Кнопки масштабирования** - Наличие кнопок увеличения и уменьшения размера текста.
3. **Индикатор масштаба** - Отображение текущего масштаба в процентах.
4. **Оптимизированная прокрутка** - Полнофункциональная прокрутка текста при любом масштабе.
5. **Сохранение пропорций** - Автоматическое масштабирование межстрочных интервалов для лучшей читаемости.

### Периодическое обновление базы данных

Реализована продвинутая система обновления базы данных песен из интернета. Приложение может периодически проверять наличие новых песен на сайте и добавлять их в локальную базу данных.

#### Ключевые компоненты:

1. **Интеллектуальный парсер** - `SongUpdater` анализирует HTML-структуру песен и корректно форматирует текст, сохраняя структуру строф и строк.

2. **Worker для обновления** - `SongUpdateWorker` выполняет периодическое обновление базы данных, проверяет наличие новых песен и добавляет их в базу данных.

3. **Управление расписанием** - `WorkManagerHelper` позволяет настраивать расписание обновлений, запускать и отменять задачи.

4. **Настройки пользователя** - Добавлены настройки, позволяющие пользователю контролировать:
   - Включение/отключение автоматических обновлений
   - Интервал обновления (12 часов, 24 часа, 48 часов, неделя)
   - Возможность запустить обновление вручную или проверить наличие новых песен

5. **Отслеживание и отображение времени обновления** - В приложении отображается время последнего обновления базы данных.

### Интерактивный интерфейс обновления

1. **Расширенная информация об обновлениях** - Пользователь видит:
   - Дату и время последнего обновления
   - Количество новых песен, добавленных при обновлении
   - Количество обновленных существующих песен
   - Общее количество песен в базе данных

2. **Интерактивный процесс обновления** - В экране настроек добавлены возможности:
   - Проверить наличие новых песен (без обновления существующих)
   - Выполнить полное обновление всех песен
   - Визуальное отображение процесса обновления и его результатов

## Технические детали

### Используемые технологии:

- **Room Database** - для локального хранения данных песен
- **WorkManager** - для выполнения фоновых задач по расписанию
- **DataStore** - для хранения пользовательских настроек
- **Jetpack Compose** - для создания современного пользовательского интерфейса
- **Coroutines & Flow** - для асинхронной работы и реактивного программирования
- **Jsoup** - для парсинга HTML-контента

### Ключевые компоненты приложения:

1. **База данных**
   - `SongDatabase` - Room база данных для хранения песен
   - `SongDao` - интерфейс для доступа к данным
   - `Song` - модель данных для песни

2. **Репозиторий и обновление**
   - `SongRepository` - репозиторий для доступа к данным из ViewModel
   - `SongUpdater` - утилита для обновления базы данных песен из интернета
   - `SongUpdateWorker` - Worker для периодического обновления в фоне
   - Интеллектуальная обработка песен с пропуском файлов оглавления (0000.html)

3. **Пользовательские настройки**
   - `UserPreferences` - класс для хранения настроек пользователя
   - `SettingsScreen` - экран настроек приложения

4. **Пользовательский интерфейс**
   - `HomeScreen` - главный экран приложения
   - `SongDetailScreen` - экран детальной информации о песне с масштабированием текста
   - `SearchScreen` - экран поиска песен
   - `FavoritesScreen` - экран избранных песен

## Последние улучшения

### Визуализация и пользовательский опыт
1. **Оптимизированные размеры шрифта** - Более компактные и читаемые размеры шрифта для всех элементов интерфейса.
2. **Улучшенное отображение песен** - Правильное форматирование строф и отступов.
3. **Плавная прокрутка** - Исправлены проблемы с прокруткой длинных текстов.
4. **Адаптивные межстрочные интервалы** - Автоматическая регулировка интервалов при изменении масштаба.

### Обработка данных
1. **Корректное распознавание песен** - Пропуск файлов оглавления (0000.html) при загрузке и обновлении.
2. **Улучшенный парсинг HTML** - Более точное извлечение и форматирование текстов песен.
3. **Оптимизация производительности** - Ускорение загрузки и обработки песен.

## Использование

### Просмотр песен
1. Запустите приложение
2. На главном экране будет список всех доступных песен
3. Нажмите на песню, чтобы просмотреть её текст

### Масштабирование текста песни
1. Откройте песню
2. Для изменения масштаба используйте:
   - Жест "щипка" (pinch-to-zoom) для плавного изменения
   - Кнопки "+" и "-" в верхней панели для пошагового изменения
3. Текущий масштаб отображается в процентах внизу экрана

### Добавление песни в избранное
1. Откройте песню
2. Нажмите на иконку звездочки в верхнем правом углу
3. Песня будет добавлена в список избранных

### Настройка автоматических обновлений
1. Перейдите в раздел "Настройки"
2. В разделе "Обновление базы данных" настройте параметры автоматического обновления:
   - Включите/выключите автоматическое обновление
   - Выберите интервал обновления (12 часов, 24 часа, 48 часов, неделя)

### Ручное обновление базы данных
1. Перейдите в раздел "Настройки"
2. В разделе "Обновление базы данных" вы найдете две опции:
   - "Проверить наличие новых песен" - проверяет только наличие новых песен
   - "Принудительное обновление" - обновляет все песни (более длительная операция)
3. Нажмите соответствующую кнопку для запуска обновления
4. Дождитесь завершения процесса обновления и просмотрите результаты

## Архитектура

Приложение построено на основе архитектуры MVVM (Model-View-ViewModel):
- **Model**: Room база данных, Repository и модели данных
- **View**: Jetpack Compose UI компоненты (экраны, диалоги и т.д.)
- **ViewModel**: ViewModel классы для управления состоянием UI и бизнес-логики

Для взаимодействия между компонентами используются корутины и Flow для асинхронной обработки и реактивного программирования.

## Источник данных

Приложение использует данные с сайта [https://maychurch.ru/songs/](https://maychurch.ru/songs/), который содержит тексты духовных песен. 